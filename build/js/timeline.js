$(function(){function e(){$(".wiki").scrollTop(0),$(".wiki img").each(function(){var e=$(this);if(e.parents().hasClass("thumb")){var t=$(".wiki .mw-parser-output").width(),a=e.width(),s=e.height()*(t/a);e.width(t),e.height(s),e.parents(".thumbinner").find(".thumbcaption").width(t)}})}function t(){var e=$(".wiki").scrollTop();Math.abs(d-e)<=p||(e>d&&e>c?$(".wiki #toc").hasClass("show-hide-content")||$(".navbar-fixed-top").removeClass("nav-down").addClass("nav-up"):$(".navbar-fixed-top").removeClass("nav-up").addClass("nav-down"),d=e)}function a(){var e=$(".authors.resiz").offset().top-7;$(".events .ui-resizable-handle").offset({top:e})}function s(){parseInt($(".years").css("left"));var e=$(document).scrollLeft();$(".years, .year-line").css({left:-e})}function i(){$("#mySidebar").toggleClass("open"),$("#chevrons").toggleClass("fa-chevron-right fa-chevron-left"),$("#mySidebar").width(v),$(".authors, .events").width(u+=v)}function o(){$("#mySidebar").toggleClass("open"),$("#chevrons").toggleClass("fa-chevron-left fa-chevron-right"),$("#mySidebar").width("5px"),$(".authors, .events").width(u-=v)}for(var n=1750;n<1900;n++){var r=$('<li class="year '+n+'"><span class="year_span">'+n+"</span></li>");$("ul.years").append(r),n%2!=0?$("ul.years li."+n).fadeTo(1,0).addClass("odd"):$("ul.years li."+n).addClass("even")}for(n=1750;n<1900;n++){var l=$('<li class="year_line_year '+n+'"><span class="year_line_year_span">'+n+"</span></li>");$(".year-line").append(l),n%2!=0?$(".year-line li."+n).fadeTo(1,0).addClass("year_odd"):$(".year-line li."+n).addClass("year_even")}$.getJSON("json_data/authors.json",function(e){$.each(e,function(e,t){var a=t.fname,s=t.lname,i=t.birth,o=t.death,n=t.m_top,r=a.replace(/\s+/g,"")+s.replace(/\s+/g,""),l=$('<div id="'+r+'" class="author '+r+'" data-birth="'+i+'" data-death="'+o+'" data-fname="'+a+'" data-lname="'+s+'"><div class="author_contents"><a>'+a+" "+s+' </a><span class="life_span">'+i+"-"+o+"</span></div></div>");$(".author_wrapper").append(l);var h=$("ul.years li."+i).offset().left,d=18*(o-i+1);$("."+r).css({position:"absolute",left:h,width:d,"background-color":"rgba(255, 0, 0, 0.5)","margin-top":n})})}).done(function(){var e=$(".author").map(function(){return parseInt($(this).css("margin-top"))}).get(),t=Math.max.apply(null,e);$(".author_wrapper").height(t);var a=$(".authors").height();$(".authors .year").height(a)}),$.getJSON("json_data/events_extract.json",function(e){$.each(e,function(e,t){var a=t.Year,s=t.Year_end,i=t.Event,o=t.m_top,n=$($.parseHTML(i)).text().replace(/[^a-zA-Z0-9]+/g," ").split(/\s+/).slice(0,5).join("_");if(a!==s)r=a+"-"+s;else var r=a;var l=$('<div data-year="'+a+'" data-year_end="'+s+'"><div id="'+n+'" class="event event_tooltip '+n+'"></div><div class="event_contents"><span class="event_year">'+r+' </span><span class="close-tooltip"><i class="fa fa-times fa-1" aria-hidden="true"></i></span><p class="event_text">'+i+"</p></div></div>");$(".events_wrapper").append(l),console.log(s);var h=$("ul.years li."+a).offset().left,d=($("ul.years li."+s).offset().left,18*(s-a+1));$("."+n).css({left:h,width:d,height:19,"margin-top":o})})}).done(function(){$(".event_tooltip").each(function(){var e=$(this).offset().left,t=$(this).offset().top;$(this).siblings(".event_contents").css({left:e,"margin-top":t+25})}),$(".event_tooltip").click(function(){var e=$(this),t=$(this).parent().data("year"),a=$(this).parent().data("year_end"),s=$(this).offset().left,i=$(this).width();!e.hasClass("expose")||$(".event.expose").length>1?($(".expose-author").removeClass("expose-author"),e.siblings().removeClass("hide-tooltip").addClass("show_tooltip"),$(".expose").removeClass("expose"),e.siblings().toggleClass("expose"),e.toggleClass("expose"),$("#overlay").fadeIn(300),$(".bring-to-front").removeClass("bring-to-front"),e.siblings(".event_contents").addClass("bring-to-front"),$(".vertical-line").css({display:"block",left:s,width:i}),$(".event_tooltip").not(e).each(function(){var e=$(this).parent().data("year"),s=$(this).parent().data("year_end");(t>=e&&t<=s||e>=t&&e<=a)&&($(this).toggleClass("expose"),$(this).siblings().removeClass("hide-tooltip").addClass("show_tooltip").toggleClass("expose"))}),$(".author").each(function(){var e=$(this).data("birth"),s=$(this).data("death");(t>=e&&t<=s||e>=t&&e<=a)&&$(this).toggleClass("expose")})):(e.siblings().removeClass("show_tooltip").addClass("hide-tooltip"),$(".vertical-line").css({display:"none"}),$(".expose-author").removeClass("expose-author"),$(".expose-author-rhombus").removeClass("expose-author-rhombus"),$(".expose").removeClass("expose"),$("#overlay").fadeOut(300))}),$(".event_contents").click(function(e){if("fa fa-times fa-1"!==e.target.className){var t=$(this);$(this).parent().data("year"),$(this).offset().left,$(this).siblings(".event_tooltip").width();$(".bring-to-front").removeClass("bring-to-front"),t.addClass("bring-to-front"),t.siblings(".event_tooltip").addClass("bring-to-front")}}),$(".event_text a").click(function(t){$("#mySidebar").hasClass("open")||i(),t.preventDefault();var a=$(this).attr("title");$.ajax({type:"GET",url:"https://en.wikipedia.org/w/api.php?action=parse&page="+a+"&prop=text&redirects=1&format=json&callback=?",contentType:"application/json; charset=utf-8",async:!1,dataType:"json",success:function(e,t,a){var s=e.parse.text["*"];$(".wiki").html(s)},error:function(e){}}).done(function(){$("#mySidebar .wiki .NavHead").append('<span class="NavHead-toggle"><i class="fa fa-chevron-down" aria-hidden="true"></i></span>'),e()})}),$(".author").click(function(t){var a=$(this);if(this_birth=$(this).data("birth"),this_death=$(this).data("death"),line_position=$(this).offset().left,line_width=$(this).width(),a.hasClass("expose-author"))$(".vertical-line").css({display:"none"}),a.removeClass("expose-author"),$(".expose-author").removeClass("expose-author"),$(".expose").removeClass("expose"),$("#overlay").fadeOut(300),o();else{$("#mySidebar").hasClass("open")||i(),$(".expose-author").removeClass("expose-author"),a.addClass("expose-author"),a.children(".rhombus").addClass("expose-author-rhombus"),$(".expose").removeClass("expose"),$(".bring-to-front").removeClass("bring-to-front"),$(this).toggleClass("expose"),$("#overlay").fadeIn(300),$(".vertical-line").css({display:"block",left:line_position,width:line_width}),$(".event_tooltip, .event_contents").each(function(){var e=$(this).parent().data("year"),t=$(this).parent().data("year_end");(this_birth>=e&&this_birth<=t||e>=this_birth&&e<=this_death)&&($(this).toggleClass("expose"),$(this).hasClass("event_contents")&&$(this).removeClass("hide-tooltip").addClass("show_tooltip"))}),$(".author").not(a).each(function(){var e=$(this).data("birth"),t=$(this).data("death");(e>=this_birth&&e<=this_death||t<=this_death&&t>=this_birth||e<=this_birth&&t>=this_death)&&$(this).toggleClass("expose")});var s=a.data("fname"),n=a.data("lname");$.ajax({type:"GET",url:"https://en.wikipedia.org/w/api.php?action=parse&page="+s+" "+n+"&prop=text&redirects=1&format=json&callback=?",contentType:"application/json; charset=utf-8",async:!1,dataType:"json",success:function(e,t,a){if(void 0!==e.parse)var s=e.parse.text["*"];$(".wiki").html(s)},error:function(e){}}).done(function(){$("#mySidebar .wiki .NavHead").append('<span class="NavHead-toggle"><i class="fa fa-chevron-down" aria-hidden="true"></i></span>'),e()})}}),$(document).click(function(e){0===$(e.target).closest(".event_tooltip, .event_contents, .author, .sidebar").length&&($(".vertical-line").css({display:"none"}),$(".expose-author").removeClass("expose-author"),$(".expose-author-rhombus").removeClass("expose-author-rhombus"),$(".expose").removeClass("expose"),$("#overlay").fadeOut(300))}),$(".close-tooltip").click(function(){$(this).parent().removeClass("show_tooltip").addClass("hide-tooltip")}),$(".event_contents").parent().draggable({axis:"y",cursor:"move",containment:".events"}),a()}),$("#mySidebar .wiki").on("click","a",function(t){if("#"!==$(this).attr("href").charAt(0)){t.preventDefault();var a=$(this).attr("title");$.ajax({type:"GET",url:"https://en.wikipedia.org/w/api.php?action=parse&page="+a+"&prop=text&redirects=1&format=json&callback=?",contentType:"application/json; charset=utf-8",async:!1,dataType:"json",success:function(e,t,a){var s=e.parse.text["*"];$.parseHTML(s);$(".wiki").html(s)},error:function(e){}}).done(function(){$("#mySidebar .wiki .NavHead").append('<span class="NavHead-toggle"><i class="fa fa-chevron-down" aria-hidden="true"></i></span>'),e()})}}),$("#mySidebar .wiki").on("click",".NavHead",function(){$(this).siblings(".NavContent").toggleClass("show-hide-content"),$(this).find(".NavHead-toggle i").toggleClass("fa-chevron-down").toggleClass("fa-chevron-up")}),$("#mySidebar").on("click",".contents-toggle",function(){$(".wiki #toc").toggleClass("show-hide-content")}),$(".wiki #toc").hasClass("show-hide-content")&&$(".navbar-fixed-top").addClass("nav-down");var h,d=0,p=30,c=$(".navbar-fixed-top").outerHeight();for($(".wiki").on("scroll",function(e){h=!0}),setInterval(function(){h&&(t(),h=!1)},250),$(".resiz").not(":last").resizable({handles:"s",minHeight:40,maxHeight:parseInt($(window).height())-40,start:function(){this.other=$(this).next(),this.startHeight=this.other.height()},resize:function(e,t){var s=t.element.resizable("option","minHeight"),i=t.size.height-t.originalSize.height;i>this.startHeight-s&&(i=this.startHeight,t.size.height=t.originalSize.height+i-s),this.other.height(Math.max(40,this.startHeight-i)),a()}}),n=1700;n<2050;n+=10)$("."+n).css({"background-color":"rgba(0, 0, 0, 0.08)","font-weight":"bold","font-size":".7em"}),n%100==0&&$("."+n).css({"font-size":".9em"});var f=$(".years").width();$(".events, .authors, .works, .year-line, #overlay").width(f),$(document).scroll(function(){s()});var v=.33*$(window).width()-5,u=$(".authors, .events").width();$(".sidebar_button").click(function(){$("#mySidebar").hasClass("open")?o():i()}),$(".sidebar_button").mouseenter(function(){$(this).find("#chevrons").css("color","#f7f7f7")}).mouseleave(function(){$(this).find("#chevrons").css("color","#434343")})});