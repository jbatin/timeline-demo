$(function(){function t(){$(".wiki").scrollTop(0),$(".wiki img").each(function(){var t=$(this);if(t.parents().hasClass("thumb")){var e=$(".wiki .mw-parser-output").width(),a=t.width(),s=t.height()*(e/a);t.width(e),t.height(s),t.parents(".thumbinner").find(".thumbcaption").width(e)}})}function e(){var t=$(".wiki").scrollTop();Math.abs(c-t)<=d||(t>c&&t>p?$(".wiki #toc").hasClass("show-hide-content")||$(".navbar-fixed-top").removeClass("nav-down").addClass("nav-up"):$(".navbar-fixed-top").removeClass("nav-up").addClass("nav-down"),c=t)}function a(){var t=$(".authors.resiz").offset().top-7;$(".events .ui-resizable-handle").offset({top:t})}function s(){parseInt($(".years").css("left"));var t=$(document).scrollLeft();$(".years, .year-line").css({left:-t})}function i(){$("#mySidebar").toggleClass("open"),$("#chevrons").toggleClass("fa-chevron-right fa-chevron-left"),$("#mySidebar").width(v),$(".authors, .events").width(u+=v)}function o(){$("#mySidebar").toggleClass("open"),$("#chevrons").toggleClass("fa-chevron-left fa-chevron-right"),$("#mySidebar").width("5px"),$(".authors, .events").width(u-=v)}for(var n=1750;n<1900;n++){var r=$('<li class="year '+n+'"><span class="year_span">'+n+"</span></li>");$("ul.years").append(r),n%2!=0?$("ul.years li."+n).fadeTo(1,0).addClass("odd"):$("ul.years li."+n).addClass("even")}for(n=1750;n<1900;n++){var l=$('<li class="year_line_year '+n+'"><span class="year_line_year_span">'+n+"</span></li>");$(".year-line").append(l),n%2!=0?$(".year-line li."+n).fadeTo(1,0).addClass("year_odd"):$(".year-line li."+n).addClass("year_even")}$.getJSON("json_data/authors.json",function(t){$.each(t,function(t,e){var a=e.fname,s=e.lname,i=e.birth,o=e.death,n=e.m_top,r=a.replace(/\s+/g,"")+s.replace(/\s+/g,""),l=$('<div id="'+r+'" class="author '+r+'" data-birth="'+i+'" data-death="'+o+'" data-fname="'+a+'" data-lname="'+s+'"><div class="author_contents"><a>'+a+" "+s+' </a><span class="life_span">'+i+"-"+o+"</span></div></div>");$(".author_wrapper").append(l);var h=$("ul.years li."+i).offset().left,c=18*(o-i+1);$("."+r).css({position:"absolute",left:h,width:c,"background-color":"rgba(255, 0, 0, 0.5)","margin-top":n})})}).done(function(){var t=$(".author").map(function(){return parseInt($(this).css("margin-top"))}).get(),e=Math.max.apply(null,t);$(".author_wrapper").height(e);var a=$(".authors").height();$(".authors .year").height(a)}),$.getJSON("json_data/events_extract.json",function(t){$.each(t,function(t,e){var a=e.Year,s=e.Year_end,i=e.Event,o=e.m_top,n=$($.parseHTML(i)).text().replace(/[^a-zA-Z0-9]+/g," ").split(/\s+/).slice(0,5).join("_");if(a!==s)r=a+"-"+s;else var r=a;var l=$('<div data-year="'+a+'"><div id="'+n+'" class="event event_tooltip '+n+'"></div><div class="event_contents"><span class="event_year">'+r+' </span><span class="close-tooltip"><i class="fa fa-times fa-1" aria-hidden="true"></i></span><p class="event_text">'+i+"</p></div></div>");$(".events_wrapper").append(l),console.log(s);var h=$("ul.years li."+a).offset().left,c=($("ul.years li."+s).offset().left,18*(s-a+1));$("."+n).css({left:h,width:c,height:19,"margin-top":o})})}).done(function(){}).done(function(){$(".event_tooltip").each(function(){var t=$(this).offset().left,e=$(this).offset().top;$(this).siblings(".event_contents").css({left:t,"margin-top":e+25})}),$(".event_tooltip").click(function(){var t=$(this),e=$(this).parent().data("year"),a=$(this).offset().left,s=$(this).width();$(".expose-author").removeClass("expose-author"),$(".expose-author-rhombus").removeClass("expose-author-rhombus"),$(this).siblings().removeClass("hide-tooltip").addClass("show_tooltip"),$(".expose").removeClass("expose"),$(this).siblings().toggleClass("expose"),$(this).toggleClass("expose"),$("#overlay").fadeIn(300),$(".bring-to-front").removeClass("bring-to-front"),t.siblings(".event_contents").addClass("bring-to-front"),$(".vertical-line").css({display:"block",left:a,width:s}),$(".event_tooltip").not(t).each(function(){var t=$(this).parent().data("year");e===t&&($(this).toggleClass("expose"),$(this).siblings().removeClass("hide-tooltip").addClass("show_tooltip").toggleClass("expose"))}),$(".author").each(function(){($(this).data("birth")===e||e>$(this).data("birth")&&e<$(this).data("death"))&&$(this).toggleClass("expose")})}),$(".event_contents").click(function(t){if("fa fa-times fa-1"!==t.target.className){var e=$(this);$(this).parent().data("year"),$(this).offset().left,$(this).siblings(".event_tooltip").width();$(".bring-to-front").removeClass("bring-to-front"),e.addClass("bring-to-front"),e.siblings(".event_tooltip").addClass("bring-to-front")}}),$(".event_text a").click(function(e){$("#mySidebar").hasClass("open")||i(),e.preventDefault();var a=$(this).attr("title");$.ajax({type:"GET",url:"https://en.wikipedia.org/w/api.php?action=parse&page="+a+"&prop=text&redirects=1&format=json&callback=?",contentType:"application/json; charset=utf-8",async:!1,dataType:"json",success:function(t,e,a){var s=t.parse.text["*"];$(".wiki").html(s)},error:function(t){}}).done(function(){$("#mySidebar .wiki .NavHead").append('<span class="NavHead-toggle"><i class="fa fa-chevron-down" aria-hidden="true"></i></span>'),t()})}),$(".author").click(function(e){var a=$(this);this_birth=$(this).data("birth"),this_death=$(this).data("death"),line_position=$(this).offset().left,line_width=$(this).width(),$("#mySidebar").hasClass("open")||i(),$(".expose-author").removeClass("expose-author"),$(".expose-author-rhombus").removeClass("expose-author-rhombus"),a.addClass("expose-author"),a.children(".rhombus").addClass("expose-author-rhombus"),$(".expose").removeClass("expose"),$(".bring-to-front").removeClass("bring-to-front"),$(this).toggleClass("expose"),$("#overlay").fadeIn(300),$(".vertical-line").css({display:"block",left:line_position,width:line_width}),$(".event_tooltip, .event_contents").each(function(){var t=$(this).parent().data("year");this_birth<=t&&t<=this_death&&($(this).toggleClass("expose"),$(this).hasClass("event_contents")&&$(this).removeClass("hide-tooltip").addClass("show_tooltip"))}),$(".author").not(a).each(function(){var t=$(this).data("birth"),e=$(this).data("death");(t>=this_birth&&t<=this_death||e<=this_death&&e>=this_birth||t<=this_birth&&e>=this_death)&&$(this).toggleClass("expose")});var s=a.data("fname"),o=a.data("lname");$.ajax({type:"GET",url:"https://en.wikipedia.org/w/api.php?action=parse&page="+s+" "+o+"&prop=text&redirects=1&format=json&callback=?",contentType:"application/json; charset=utf-8",async:!1,dataType:"json",success:function(t,e,a){if(void 0!==t.parse)var s=t.parse.text["*"];$(".wiki").html(s)},error:function(t){}}).done(function(){$("#mySidebar .wiki .NavHead").append('<span class="NavHead-toggle"><i class="fa fa-chevron-down" aria-hidden="true"></i></span>'),t()})}),$(document).click(function(t){0===$(t.target).closest(".event_tooltip, .event_contents, .author, .sidebar").length&&($(".vertical-line").css({display:"none"}),$(".expose-author").removeClass("expose-author"),$(".expose-author-rhombus").removeClass("expose-author-rhombus"),$(".expose").removeClass("expose"),$("#overlay").fadeOut(300))}),$(".close-tooltip").click(function(){$(this).parent().removeClass("show_tooltip").addClass("hide-tooltip")}),$(".event_contents").parent().draggable({axis:"y",cursor:"move",containment:".events"}),a()}),$("#mySidebar .wiki").on("click","a",function(e){if("#"!==$(this).attr("href").charAt(0)){e.preventDefault();var a=$(this).attr("title");$.ajax({type:"GET",url:"https://en.wikipedia.org/w/api.php?action=parse&page="+a+"&prop=text&redirects=1&format=json&callback=?",contentType:"application/json; charset=utf-8",async:!1,dataType:"json",success:function(t,e,a){var s=t.parse.text["*"];$.parseHTML(s);$(".wiki").html(s)},error:function(t){}}).done(function(){$("#mySidebar .wiki .NavHead").append('<span class="NavHead-toggle"><i class="fa fa-chevron-down" aria-hidden="true"></i></span>'),t()})}}),$("#mySidebar .wiki").on("click",".NavHead",function(){$(this).siblings(".NavContent").toggleClass("show-hide-content"),$(this).find(".NavHead-toggle i").toggleClass("fa-chevron-down").toggleClass("fa-chevron-up")}),$("#mySidebar").on("click",".contents-toggle",function(){$(".wiki #toc").toggleClass("show-hide-content")}),$(".wiki #toc").hasClass("show-hide-content")&&$(".navbar-fixed-top").addClass("nav-down");var h,c=0,d=30,p=$(".navbar-fixed-top").outerHeight();for($(".wiki").on("scroll",function(t){h=!0}),setInterval(function(){h&&(e(),h=!1)},250),$(".resiz").not(":last").resizable({handles:"s",minHeight:40,maxHeight:parseInt($(window).height())-40,start:function(){this.other=$(this).next(),this.startHeight=this.other.height()},resize:function(t,e){var s=e.element.resizable("option","minHeight"),i=e.size.height-e.originalSize.height;i>this.startHeight-s&&(i=this.startHeight,e.size.height=e.originalSize.height+i-s),this.other.height(Math.max(40,this.startHeight-i)),a()}}),n=1700;n<2050;n+=10)$("."+n).css({"background-color":"rgba(0, 0, 0, 0.08)","font-weight":"bold","font-size":".7em"}),n%100==0&&$("."+n).css({"font-size":".9em"});var f=$(".years").width();$(".events, .authors, .works, .year-line, #overlay").width(f),$(document).scroll(function(){s()});var v=.33*$(window).width()-5,u=$(".authors, .events").width();$(".sidebar_button").click(function(){$("#mySidebar").hasClass("open")?o():i()}),$(".sidebar_button").mouseenter(function(){$(this).find("#chevrons").css("color","#f7f7f7")}).mouseleave(function(){$(this).find("#chevrons").css("color","#434343")})});