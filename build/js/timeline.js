$(function(){function t(){$(".wiki").scrollTop(0),$(".wiki img").each(function(){var t=$(this);if(t.parents().hasClass("thumb")){var e=$(".wiki .mw-parser-output").width(),s=t.width(),a=t.height()*(e/s);t.width(e),t.height(a),t.parents(".thumbinner").find(".thumbcaption").width(e)}})}function e(){var t=$(".wiki").scrollTop();Math.abs(c-t)<=p||(t>c&&t>d?$(".wiki #toc").hasClass("show-hide-content")||$(".navbar-fixed-top").removeClass("nav-down").addClass("nav-up"):$(".navbar-fixed-top").removeClass("nav-up").addClass("nav-down"),c=t)}function s(){var t=$(".authors.resiz").offset().top-7;$(".events .ui-resizable-handle").offset({top:t})}function a(){parseInt($(".years").css("left"));var t=$(document).scrollLeft();$(".years, .year-line").css({left:-t})}function i(){$("#mySidebar").toggleClass("open"),$("#chevrons").toggleClass("fa-chevron-right fa-chevron-left"),$("#mySidebar").width(v),$(".authors, .events").width(u+=v)}function o(){$("#mySidebar").toggleClass("open"),$("#chevrons").toggleClass("fa-chevron-left fa-chevron-right"),$("#mySidebar").width("5px"),$(".authors, .events").width(u-=v)}for(var n=1750;n<1900;n++){var r=$('<li class="year '+n+'"><span class="year_span">'+n+"</span></li>");$("ul.years").append(r),n%2!=0?$("ul.years li."+n).fadeTo(1,0).addClass("odd"):$("ul.years li."+n).addClass("even")}for(n=1750;n<1900;n++){var h=$('<li class="year_line_year '+n+'"><span class="year_line_year_span">'+n+"</span></li>");$(".year-line").append(h),n%2!=0?$(".year-line li."+n).fadeTo(1,0).addClass("year_odd"):$(".year-line li."+n).addClass("year_even")}$.getJSON("json_data/authors.json",function(t){$.each(t.authors,function(t,e){var s=e.fname,a=e.lname,i=e.birth,o=e.death,n=s.replace(/\s+/g,"")+a.replace(/\s+/g,""),r=$('<div id="'+n+'" class="author '+n+'" data-birth="'+i+'" data-death="'+o+'" data-fname="'+s+'" data-lname="'+a+'"><div class="rhombus rhombus_left" /><div class="author_contents"><a>'+s+" "+a+' </a><span class="life_span">'+i+"-"+o+'</span></div><div class="rhombus rhombus_right" /></div>');$(".author_wrapper").append(r);var h=$("ul.years li."+i).offset().left+9,l=$("ul.years li."+o).offset().left-9-h;$("."+n).css({position:"absolute",left:h,width:l,"background-color":"rgba(255, 0, 0, 0.5)","margin-top":20*(t+1)})})}).done(function(){var t=[];$(".author").each(function(){var e=$(this),s=e.attr("class"),a=parseInt(e.css("left")),i=parseInt(e.css("width")),o=a+i,r=20,h=t.length;$(".author").each(function(i){var l=$(this),c=l.attr("class"),p=parseInt(l.css("left")),d=p+parseInt(l.css("width")),f=parseInt(l.css("margin-top"));if(s===c)return!1;if(h>0){for(n=0;n<h;n++)if(s!==t[n][3])if((o<=p||a>=d)&&(o<=t[n][0]||a>=t[n][1]))for(e.css("margin-top",r),j=0;j<t.length;j++)t[j][3]===s?t[j][2]=r:j+1===t.length&&t.push([a,o,r,s]);else a<d&&d<o||a<p&&p<o||p<a&&d>o?r===f?(r+=20,e.css("margin-top",r)):e.css("margin-top",r):(a<t[n][1]&&t[n][1]<o||a<t[n][0]&&t[n][0]<o||t[n][0]<a&&t[n][1]>o)&&(r===t[n][2]?(r+=20,e.css("margin-top",r)):e.css("margin-top",r))}else{if(o<=p||a>=d)return e.css("margin-top",f),t.push([a,o,f,s]),!1;var v=f+20;e.css("margin-top",v)}})})}).done(function(){var t=$(".author").map(function(){return parseInt($(this).css("margin-top"))}).get(),e=Math.max.apply(null,t);$(".author_wrapper").height(e);var s=$(".authors").height();$(".authors .year").height(s)}),$.getJSON("json_data/events_extract.json",function(t){$.each(t,function(t,e){var s=e.Year,e=e.Event,a=$($.parseHTML(e)).text();event_class=a.replace(/[^a-zA-Z0-9]+/g," ").split(/\s+/).slice(0,5).join("_");var i=$('<div data-year="'+s+'"><div id="'+event_class+'" class="event event_tooltip '+event_class+'"></div><div class="event_contents"><span class="event_year">'+s+' </span><span class="close-tooltip"><i class="fa fa-times fa-1" aria-hidden="true"></i></span><p class="event_text">'+e+"</p></div></div>");$(".events_wrapper").append(i);var o=Math.sqrt(Math.pow(20,2)/2),n=(20-o)/2,r=$("ul.years li."+s).offset().left+n;$("."+event_class).css({left:r,width:o,height:o,"margin-top":20*(t+1)})})}).done(function(){var t=[];$(".event").each(function(){var e=$(this),s=e.attr("class"),a=parseInt(e.css("left")),i=20,o=t.length;$(".event").each(function(r){var h=$(this),l=h.attr("class"),c=parseInt(h.css("left")),p=parseInt(h.css("margin-top"));if(s===l)return!1;if(o>0){for(n=0;n<o;n++)if(s!==t[n][2])if(a!==c&&a!==t[n][0])for(e.css("margin-top",i),j=0;j<t.length;j++)t[j][2]===s?t[j][1]=i:j+1===t.length&&t.push([a,i,s]);else a===c?i===p?(i+=20,e.css("margin-top",i)):e.css("margin-top",i):a===t[n][0]&&(i===t[n][1]?(i+=20,e.css("margin-top",i)):e.css("margin-top",i))}else{if(a!==c)return e.css("margin-top",p),t.push([a,p,s]),!1;var d=p+20;e.css("margin-top",d)}})})}).done(function(){$(".event_tooltip").each(function(){var t=$(this).offset().left,e=$(this).offset().top;$(this).siblings(".event_contents").css({left:t,"margin-top":e+25})}),$(".event_tooltip").click(function(){var t=$(this),e=$(this).parent().data("year"),s=$(this).offset().left,a=$(this).width();$(".expose-author").removeClass("expose-author"),$(".expose-author-rhombus").removeClass("expose-author-rhombus"),$(this).siblings().removeClass("hide-tooltip").addClass("show_tooltip"),$(".expose").removeClass("expose"),$(this).siblings().toggleClass("expose"),$(this).toggleClass("expose"),$("#overlay").fadeIn(300),$(".bring-to-front").removeClass("bring-to-front"),t.siblings(".event_contents").addClass("bring-to-front"),$(".vertical-line").css({display:"block",left:s,width:a}),$(".event_tooltip").not(t).each(function(){var t=$(this).parent().data("year");e===t&&($(this).toggleClass("expose"),$(this).siblings().removeClass("hide-tooltip").addClass("show_tooltip").toggleClass("expose"))}),$(".author").each(function(){($(this).data("birth")===e||e>$(this).data("birth")&&e<$(this).data("death"))&&$(this).toggleClass("expose")})}),$(".event_contents").click(function(t){if("fa fa-times fa-1"!==t.target.className){var e=$(this);$(this).parent().data("year"),$(this).offset().left,$(this).siblings(".event_tooltip").width();$(".bring-to-front").removeClass("bring-to-front"),e.addClass("bring-to-front"),e.siblings(".event_tooltip").addClass("bring-to-front")}}),$(".event_text a").click(function(e){$("#mySidebar").hasClass("open")||i(),e.preventDefault();var s=$(this).attr("title");$.ajax({type:"GET",url:"http://en.wikipedia.org/w/api.php?action=parse&page="+s+"&prop=text&redirects=1&format=json&callback=?",contentType:"application/json; charset=utf-8",async:!1,dataType:"json",success:function(t,e,s){var a=t.parse.text["*"];$(".wiki").html(a)},error:function(t){}}).done(function(){$("#mySidebar .wiki .NavHead").append('<span class="NavHead-toggle"><i class="fa fa-chevron-down" aria-hidden="true"></i></span>'),t()})}),$(".author").click(function(e){var s=$(this);this_birth=$(this).data("birth"),this_death=$(this).data("death"),line_position=$(this).offset().left,line_width=$(this).width()+18,$("#mySidebar").hasClass("open")||i(),$(".expose-author").removeClass("expose-author"),$(".expose-author-rhombus").removeClass("expose-author-rhombus"),s.addClass("expose-author"),s.children(".rhombus").addClass("expose-author-rhombus"),$(".expose").removeClass("expose"),$(".bring-to-front").removeClass("bring-to-front"),$(this).toggleClass("expose"),$("#overlay").fadeIn(300),$(".vertical-line").css({display:"block",left:line_position-9,width:line_width}),$(".event_tooltip, .event_contents").each(function(){var t=$(this).parent().data("year");this_birth<=t&&t<=this_death&&($(this).toggleClass("expose"),$(this).hasClass("event_contents")&&$(this).removeClass("hide-tooltip").addClass("show_tooltip"))}),$(".author").not(s).each(function(){var t=$(this).data("birth"),e=$(this).data("death");(t>=this_birth&&t<=this_death||e<=this_death&&e>=this_birth||t<=this_birth&&e>=this_death)&&$(this).toggleClass("expose")});var a=s.data("fname"),o=s.data("lname");$.ajax({type:"GET",url:"http://en.wikipedia.org/w/api.php?action=parse&page="+a+" "+o+"&prop=text&redirects=1&format=json&callback=?",contentType:"application/json; charset=utf-8",async:!1,dataType:"json",success:function(t,e,s){if(void 0!==t.parse)var a=t.parse.text["*"];$(".wiki").html(a)},error:function(t){}}).done(function(){$("#mySidebar .wiki .NavHead").append('<span class="NavHead-toggle"><i class="fa fa-chevron-down" aria-hidden="true"></i></span>'),t()})}),$(document).click(function(t){0===$(t.target).closest(".event_tooltip, .event_contents, .author, .sidebar").length&&($(".vertical-line").css({display:"none"}),$(".expose-author").removeClass("expose-author"),$(".expose-author-rhombus").removeClass("expose-author-rhombus"),$(".expose").removeClass("expose"),$("#overlay").fadeOut(300))}),$(".close-tooltip").click(function(){$(this).parent().removeClass("show_tooltip").addClass("hide-tooltip")}),$(".event_contents").parent().draggable({axis:"y",cursor:"move",containment:".events"}),s()}),$("#mySidebar .wiki").on("click","a",function(e){if("#"!==$(this).attr("href").charAt(0)){e.preventDefault();var s=$(this).attr("title");$.ajax({type:"GET",url:"http://en.wikipedia.org/w/api.php?action=parse&page="+s+"&prop=text&redirects=1&format=json&callback=?",contentType:"application/json; charset=utf-8",async:!1,dataType:"json",success:function(t,e,s){var a=t.parse.text["*"];$.parseHTML(a);$(".wiki").html(a)},error:function(t){}}).done(function(){$("#mySidebar .wiki .NavHead").append('<span class="NavHead-toggle"><i class="fa fa-chevron-down" aria-hidden="true"></i></span>'),t()})}}),$("#mySidebar .wiki").on("click",".NavHead",function(){$(this).siblings(".NavContent").toggleClass("show-hide-content"),$(this).find(".NavHead-toggle i").toggleClass("fa-chevron-down").toggleClass("fa-chevron-up")}),$("#mySidebar").on("click",".contents-toggle",function(){$(".wiki #toc").toggleClass("show-hide-content")}),$(".wiki #toc").hasClass("show-hide-content")&&$(".navbar-fixed-top").addClass("nav-down");var l,c=0,p=30,d=$(".navbar-fixed-top").outerHeight();for($(".wiki").on("scroll",function(t){l=!0}),setInterval(function(){l&&(e(),l=!1)},250),$(".resiz").not(":last").resizable({handles:"s",minHeight:40,maxHeight:parseInt($(window).height())-40,start:function(){this.other=$(this).next(),this.startHeight=this.other.height()},resize:function(t,e){var a=e.element.resizable("option","minHeight"),i=e.size.height-e.originalSize.height;i>this.startHeight-a&&(i=this.startHeight,e.size.height=e.originalSize.height+i-a),this.other.height(Math.max(40,this.startHeight-i)),s()}}),n=1700;n<2050;n+=10)$("."+n).css({"border-left":"1px solid rgba(0, 0, 0, 0.15)","font-weight":"bold","font-size":".7em"}),n%100==0&&$("."+n).css({"font-size":".9em"});var f=$(".years").width();$(".events, .authors, .works, .year-line, #overlay").width(f),$(document).scroll(function(){a()});var v=.33*$(window).width()-5,u=$(".authors, .events").width();$(".sidebar_button").click(function(){$("#mySidebar").hasClass("open")?o():i()}),$(".sidebar_button").mouseenter(function(){$(this).find("#chevrons").css("color","#f7f7f7")}).mouseleave(function(){$(this).find("#chevrons").css("color","#434343")})});